#Amyzonis' IR overhaul of formables

country_decisions = {

# Post-Discovery Formables	 

# 	Spain	 
	
	ir_spain_nation = { #MODIFIED TO SIGNIFY THE UNION OF ARAGON AND CASTILLE
		major = yes
		potential = {
			NOT = { has_country_flag = formed_spain_flag }
			OR = {
				tag = ARA
				tag = CAS
			}
			IBE = { exists = no }
			SPA = { exists = no }
			is_nomad = no
			NOT = { religion_group = muslim }			#Muslims go for Andalusia
			OR = {
				primary_culture = castillian	
				primary_culture = asturian
				primary_culture = extremaduran
				primary_culture = aragonese
				primary_culture = catalan
				primary_culture = leonese
				primary_culture = galician
			}
		}
		provinces_to_highlight = {
			spa_core_provinces = yes 
			#aragon_region = yes
			#castille_region = yes
		}
		allow = {
			if = { limit = { OR = { tag = CAS tag = LON  #Potentially other castillian or leonese tags
				} }
				tier_2_formable_trigger = {
					PROVINCES=aragon_region
					AMOUNT=20 #20/33 
				}
				
				220 = { country_or_non_sovereign_subject_holds = CAS }
				333 = { country_or_non_sovereign_subject_holds = CAS }
				214 = { country_or_non_sovereign_subject_holds = CAS }
				213 = { country_or_non_sovereign_subject_holds = CAS }
			}
			if = { limit = { tag = ARA } 
				tier_2_formable_trigger = {
					PROVINCES=castille_region
					AMOUNT=40 #40/69
				}
				
				1746 = { country_or_non_sovereign_subject_holds = ARA }
				217 = { country_or_non_sovereign_subject_holds = ARA }
				219 = { country_or_non_sovereign_subject_holds = ARA }
				208 = { country_or_non_sovereign_subject_holds = ARA }
			}
			NOT = { current_age = age_of_discovery }
			is_at_war = no
		}
		effect = {
			swap_non_generic_missions = yes
			#Integrate dominions and unions
			every_subject_country = { 
				limit = { capital_scope = { region = iberia_region } OR = { is_subject_of_type = personal_union is_subject_of_type = dominion is_subject_of_type = fief } }
				ROOT = { inherit = PREV }
			}
			change_tag = SPA
			set_empire_rank = { TOOLTIP = ir_upgrade_to_empire } 
			add_country_modifier = {
				name = centralization_modifier
				duration = 7300
			}
			add_prestige = 25
			if = {
				limit = {
					has_custom_ideas = no
					NOT = { has_idea_group = SPA_ideas }
				}
				country_event = { id = ideagroups.1 } #Swap Ideas
			}
			set_country_flag = formed_spain_flag
			hidden_effect = {
				LON = {
					every_subject_country = {
						limit = { capital_scope = { region = iberia_region } }
						LON = { inherit = PREV }
					}
				}
			}
		}
		ai_will_do = {
			factor = 1
		}
		ai_importance = 400 #
	}
	
#END	
}