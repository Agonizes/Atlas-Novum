#IR Portuguese mission overhaul
#slot 1
por_slot_1 = {

	slot = 1
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	por_iberian_unity = {
		icon = mission_alliances
		required_missions = { por_centralization }
		position = 2
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			country_or_non_sovereign_subject_holds = CAS
		}
		
		trigger = {
			if = {
				limit = { exists = CAS NOT = { exists = SPA } }
				marriage_with = CAS
			}
			else_if = {
				limit = { exists = SPA NOT = { exists = CAS } }
				marriage_wist = SPA
			}
		}
		
		effect = {
			add_prestige = 5
		}
	}
	
	por_intervene_cas = {
		icon = mission_alliances
		required_missions = { por_iberian_unity }
		position = 3
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			country_or_non_sovereign_subject_holds = CAS
		}
		
		trigger = {
			#has_country_modifier = por_won_wocs
		}
		
		effect = {
			create_union = LON
			create_subject = {
				subject_type = fief
				subject = GAL
			}
			create_subject = {
				subject_type = fief
				subject = EXT
			}
		}
	}
	
}

#slot 2
por_slot_2 = {

	slot = 2
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	por_centralization = {
		icon = mission_have_two_subjects
		required_missions = { }
		position = 1
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			por_core_provinces = yes
			NOT = { owned_by = ROOT }
		}
		
		trigger = {
			conquest_mission_trigger = {
				TOOLTIP=country_holds_or_non_sovereign_subject_holds_highlighted 
				PROVINCES=por_core_provinces
				OWNER_TYPE=country_or_non_sovereign_subject_holds
			}
			NOT = { exists = BGC }
			NOT = { exists = VSU }
			NOT = { exists = COI }
			NOT = { exists = BJ1 }
		}
		
		effect = {
			add_adm_power = 75
			add_country_modifier = {
				name = "por_centralize"
				duration = 7300
			}
		}
	}
	
	por_consolidate_authority = {
		icon = mission_have_two_subjects
		required_missions = { por_centralization }
		position = 2
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			por_core_provinces = yes
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			average_home_autonomy = 30
		}
		
		effect = {
			change_government_reform_progress = 75
		}
	}
	
	por_reorganize_cortes = {
		icon = mission_rb_monopolize_the_channel
		required_missions = { por_consolidate_authority }
		position = 3
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		
		trigger = {
			if = {
				limit = { has_estate = estate_nobles }
				NOT = {
					estate_influence = {
    					estate = estate_nobles
   						influence = 25
					}			
				}
			}
			if = {
				limit = { has_estate = estate_church }
				NOT = {
					estate_influence = {
    					estate = estate_church
   						influence = 25
					}			
				}
			}
			if = {
				limit = { has_estate = estate_burghers }
				NOT = {
					estate_influence = {
    					estate = estate_burghers
   						influence = 25
					}			
				}
			}
		}
		
		effect = {
		#	change_government_reform_progress = 75
		}
	}
	
	por_invest_sagres = {
		icon = mission_rb_monopolize_the_channel
		required_missions = { por_reorganize_cortes por_navy_build }
		position = 4
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		
		trigger = {
			treasury = 200
			navy_tradition = 30
			conquest_mission_trigger = {
				TOOLTIP=country_holds_or_non_sovereign_subject_holds_highlighted 
				PROVINCES=por_algarve_provinces
				OWNER_TYPE=country_or_non_sovereign_subject_holds
			}
		}
		
		effect = {
			add_country_modifier = {
				name = "sagres_trained_captains"
				duration = -1
			}
			if = { 
				limit = { 230 = { NOT = { has_province_modifier = por_sacres } } }
				add_province_modifier = {
					name = "por_sacres"
					duration = -1
				}
			}
			if = {
				limit = { NOT = { has_government_reform = noble_explorers_reform } }
				add_government_reform = noble_explorers_reform
			}	
		}
	}
	
	por_carrack = {
		icon = mission_galleys_in_port
		required_missions = { por_invest_sagres }
		position = 5
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			treasury = 500
			num_of_heavy_ships = 15
			dip_tech = 9
			has_idea = overseas_exploration
		}
		
		effect = {
			add_country_modifier = {
				name = "por_carrack"
				duration = -1
			}
		}
	}
	
	por_frota_em_sur = {
		icon = mission_galleys_in_port
		required_missions = { por_carrack por_caravel }
		position = 6
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			treasury = 500
			num_of_heavy_ships = 50
			num_of_light_ships = 100
			mil_power = 400
		}
		
		effect = {
			add_country_modifier = {
				name = "por_frota_em_sur"
				duration = -1
			}
		}
	}
}

#slot 3
por_slot_3 = {

	slot = 3
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	por_navy_build = {
		icon = mission_galleys_in_port
		required_missions = { por_crusade_trade por_control_tangiers }
		position = 3
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			navy_size_percentage = 0.9
			num_of_heavy_ship = 5
			230 = {
				owned_by = ROOT
				has_province_modifier = por_sacres
			}
		}
		
		effect = {
			add_navy_tradition = 5
			add_country_modifier = {
				name = "por_navigators_legacy"
				duration = -1
			}
		}
	}
	
	por_navy_expand = {
		icon = mission_galleys_in_port
		required_missions = { por_navy_build }
		position = 4
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			treasury = 200
			num_of_ports = 20
			dock = 5
		}
		
		effect = {
			add_navy_tradition = 5
			227 = { add_building = shipyard }
			230 = { add_building = shipyard }
			231 = { add_building = shipyard }
		}
	}
	
	por_caravel = {
		icon = mission_galleys_in_port
		required_missions = { por_navy_expand }
		position = 5
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			treasury = 250
			num_of_light_ships = 30
			dip_tech = 9
			has_idea = overseas_exploration
		}
		
		effect = {
			add_country_modifier = {
				name = "por_caravel"
				duration = -1
			}
		}
	}
}

#slot 4
por_slot_4 = {

	slot = 4
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	
	por_crusade_trade = {
		icon = mission_rb_monopolize_the_channel
		required_missions = { por_dum_diversas por_centralization }
		position = 2
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		
		trigger = {
			227 = { #Lisbon
				trade_share = {
					country = ROOT
					share = 60
				}
			}
			345 = { #Safi
				trade_share = {
					country = ROOT
					share = 30
				}
			}
		}
		
		effect = {
			add_dip_power = 50
			227 = { #Lisbon
				add_trade_modifier = {
					who = ROOT
					duration = 7300
					power = 25
					key = lisbon_ambition
				}
			}
			345 = { #Safi
				add_trade_modifier = {
					who = ROOT
					duration = 7300
					power = 25
					key = safi_ambition
				}
			}
		}
	}
}

#slot 5
por_slot_5 = {

	slot = 5
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	por_dum_diversas = {
		icon = mission_rb_monopolize_the_channel
		required_missions = { }
	
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
	
		trigger = {
			any_rival_country = {
				custom_trigger_tooltip = {
					tooltip = capital_maghreb.tooltip
					capital_scope = { region = maghreb_region }
				}
				is_neighbor_of = ROOT
				religion_group = muslim
			}
			PAP = { 
				has_opinion = {
					who = ROOT
					value = 50
				}
			}
		}
		
		effect = {
			add_country_modifier = {
				name = "por_dum_diversas"
				duration = 7300
			}
			334 = {
				limit = { NOT = { country_or_non_sovereign_subject_holds = ROOT } } 
				add_permanent_claim = ROOT
			}
		}
	}
	
	por_control_tangiers = {
		icon = mission_unite_home_region
		required_missions = { por_dum_diversas }
		position = 2
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			province_id = 334
			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			control_mission_trigger = {
				TOOLTIP=country_holds_or_non_sovereign_subject_holds_highlighted 
				PROVINCES=334
			}
		}
		
		effect = {
			#Amyzonis - NEEDED CODE for CONTROL missions - ensures that provinces are properly annexed
			every_province = {
				limit = { province_id = 334 country_or_non_sovereign_subject_controls = ROOT }
				change_controller = ROOT
				cede_province = ROOT
			}
			#Remove bypass modifier on Ceuta - only valuable with Tangier
			1751 = { remove_province_modifier = bypassed_by_tangiers }
			#Cripple AI Morocco through a somewhat historical turn of events. Morocco could be strong in theory, but they are prone to internal disputes, one represented here.
			if = { 
				limit = { MOR = { ai = yes } }
				MOR = { country_event = { id = orion_colonial.1 days = 0 } }
			}
			#Amyzonis AE modifier to balance control missions
			if = {
				limit = { NOT = { has_country_modifier = ae_boost } }
				add_country_modifier = {
					name = "ae_boost"
					duration = 1825
				}
			}
			else_if = {
				limit = { has_country_modifier = ae_boost }
				hidden_effect = {
					remove_country_modifier = ae_boost
				}
				add_country_modifier = {
					name = "ae_boost"
					duration = 1825
				}
			}
			#claims
			348 = {
				limit = { NOT = { country_or_non_sovereign_subject_holds = ROOT } } 
				add_permanent_claim = ROOT
			}
		}
	}
	
	por_control_mazagao = {
		icon = mission_unite_home_region
		required_missions = { por_control_tangiers }
		position = 3
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		provinces_to_highlight = {
			province_id = 348
 			NOT = { country_or_non_sovereign_subject_holds = ROOT }
		}
		
		trigger = {
			control_mission_trigger = {
				TOOLTIP=country_holds_or_non_sovereign_subject_holds_highlighted 
				PROVINCES=348
			}
		}
		
		effect = {
			#Amyzonis - NEEDED CODE for CONTROL missions - ensures that provinces are properly annexed
			every_province = {
				limit = { province_id = 348 country_or_non_sovereign_subject_controls = ROOT }
				change_controller = ROOT
				cede_province = ROOT
			}
			#Amyzonis AE modifier to balance control missions
			if = {
				limit = { NOT = { has_country_modifier = ae_boost } }
				add_country_modifier = {
					name = "ae_boost"
					duration = 1825
				}
			}
			else_if = {
				limit = { has_country_modifier = ae_boost }
				hidden_effect = {
					remove_country_modifier = ae_boost
				}
				add_country_modifier = {
					name = "ae_boost"
					duration = 1825
				}
			}
			#claims
			#348 = {
			#	limit = { NOT = { country_or_non_sovereign_subject_holds = ROOT } } 
			#	add_permanent_claim = ROOT
			#}
		}
	}
	
	por_crusade_morocco = {
		icon = mission_unite_home_region
		required_missions = { por_navy_build }
		position = 4
		
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
		
		trigger = {
			#has_country_flag = 
		}
		
		effect = {
			#custom_tooltip = por_crusade_morocco_claims
			hidden_effect = {
				every_province = {
					limit = {
						por_morocco_provinces = yes
						NOT = { is_core = ROOT }
						NOT = { owned_by = ROOT }
					}
					add_permanent_claim = ROOT
				}
			}
		}
	}
}

#slot 6
por_slot_6 = {

	slot = 6
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	
	por_romanus_pontifex = {
		icon = mission_european_church
		required_missions = { por_dum_diversas }
		position = 2
	
		ai_weight = {
			factor = 5
		}
		ai_priority = {
			factor = 5
		}
	
		trigger = {
			PAP = { 
				has_opinion = {
					who = ROOT
					value = 100
				}
			}
		}
		
		effect = {
			add_prestige = 5
			add_legitimacy = 5
			add_country_modifier = {
				name = "por_romanus_pontifex"
				duration = 7300
			}
		}
	}
}

#slot 7
por_slot_7 = {

	slot = 7
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
}

#slot 8
por_slot_8 = {

	slot = 8
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
	por_alem_do_bojador = {
		icon = mission_establish_high_seas_navy
		required_missions = { }
		
		provinces_to_highlight = {
			por_bojador_provinces = yes
			has_discovered = ROOT
		}
		
		trigger = {
			discover_mission_trigger = {
				TOOLTIP=country_holds_or_non_sovereign_subject_holds_highlighted 
				PROVINCES=por_bojador_provinces
			}
		}
		
		effect = {
			add_dip_power = 25 
			if = { 
				limit = { 1111 = { is_empty = yes } }
				hidden_effect = {
					1111 = {
						change_trade_goods = slaves
						change_religion = ROOT	
						change_culture = ROOT
						add_core = POR	
					}
				}
				1111 = { 
					cede_province = ROOT 
					add_province_modifier = {
						name = "por_feitoria"
						duration = -1
					}
				}
			}
			if = { 
				limit = { 1111 = { is_city = yes NOT = { country_or_non_sovereign_subject_holds = ROOT } } }
				if = {
					limit = { 
						1111 = { owner = { is_colonizer_tech_group = no } }
					}
					hidden_effect = {
						1111 = {
							owner = { country_event = { id = orion_seize.1 days = 0 } }
							change_trade_goods = slaves
							add_core = POR	
						}	
					}
					1111 = { 
						cede_province = ROOT 
						add_province_modifier = {
							name = "por_feitoria"
							duration = -1
						}
					}
				}
				else_if = {
					limit = { 
						1111 = { owner = { is_colonizer_tech_group = yes } } 
					}
					1111 = { add_permanent_claim = ROOT }
				}
			}
		}
	}
	
}

#slot 9
por_slot_9 = {

	slot = 9
	generic = no
	ai = yes
	
	potential = {
		OR = {
			tag = POR
			tag = LSA	
		}
	}
	has_country_shield = yes
	
}