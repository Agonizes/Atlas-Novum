#Complete Overhaul of the Italian Wars as a major European conflict in the age of Discovery
# Amyzonis

namespace = italian_wars

#manpower bonus and event notification for joining league
country_event = {
	id = italian_wars.0
	title = "italian_wars.0.t"
	desc = "italian_wars.0.d"
	picture = DIPLOMACY_eventPicture
	
	#fire_only_once = yes
	is_triggered_only = yes
	major = yes
	
	
	option = {
		name = "italian_wars.0.a"
		add_manpower = 10
		add_years_of_income = 0.5
		#FROM = { set_country_flag = select_league_1 }
	}
}


country_event = {
	id = italian_wars.1
	title = "italian_wars.1.t"
	desc = "italian_wars.1.d"
	picture = BAD_WITH_MONARCH_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = ARA
		is_lesser_in_union = no
		NAP = { is_subject_of = ROOT }
		#is_year = 1450
		#NOT = { is_year = 1550 }
		ARA = { NOT = { has_ruler = "Alfons V" } }
	}
	
	mean_time_to_happen = {
		days = 1
		modifier = {
			factor = 0.01
			ARA = { NOT = { has_ruler = "Alfons V" } }
		}
	}
	
	option = {
		name = "italian_wars.1.a"
		ai_chance = { factor = 50 }
		NAP = { grant_independence = yes }
		create_alliance = NAP
		add_prestige = -5
		set_country_flag = lost_naples
		if = { 
			limit = { NAV = { has_ruler = "Joan II" } }
			create_union = NAV
		}
				
	}
	option = {
		name = "italian_wars.1.b"
		ai_chance = { factor = 50 }
		NAP = { grant_independence = yes }
		add_casus_belli = {
			target = NAP
			type = cb_restore_personal_union
		 	months = 60
		}
		add_prestige = 5
		set_country_flag = lost_naples
		if = { 
			limit = { NAV = { has_ruler = "Joan II" } }
			create_union = NAV
		}
	}
}


country_event = {
	id = italian_wars.2
	title = "italian_wars.2.t"
	desc = "italian_wars.2.d"
	picture = DIPLOMACY_eventPicture
	
	major = yes
	fire_only_once = yes
	
	trigger = {
		has_country_flag = IW_trigger_1
	}
	
	mean_time_to_happen = {
		months = 18
	}
	
	option = {
		name = "italian_wars.2.a"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = VEN
			VEN = { total_development = ROOT }
		}
		hidden_effect = { 
			VEN = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.b"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = MLO
			MLO = { total_development = ROOT }
		}
		hidden_effect = { 
			MLO = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.c"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = GEN
			GEN = { total_development = ROOT }
		}
		hidden_effect = { 
			GEN = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.d1"
		ai_chance = { 
			factor = 12 
		}
		trigger = {
			is_rival = SAV
			SAV = { total_development = ROOT }
		}
		hidden_effect = { 
			SAV = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.e"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = LAN
			LAN = { total_development = ROOT }
		}
		hidden_effect = { 
			LAN = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.f"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = PAP
			PAP = { total_development = ROOT }
		}
		hidden_effect = { 
			PAP = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
	option = {
		name = "italian_wars.2.g"
		ai_chance = { factor = 12 }
		trigger = {
			is_rival = NAP
			NAP = { total_development = ROOT }
		}
		hidden_effect = { 
			NAP = { 
				set_country_flag = IW_rival_1 
				save_global_event_target_as = IW_rival_1
			}
		}
	}
}

country_event = {
	id = italian_wars.3
	title = "italian_wars.3.t"
	desc = "italian_wars.3.d"
	picture = BATTLE_eventPicture
	
	major = yes
	fire_only_once = yes
	
	trigger = {
		has_global_flag = IW_activate_1
		NOT = { has_global_flag = IW_outsider_select }
		has_country_flag = IW_optin_1	
		is_at_war = no
		great_power = yes
		NOT = { capital_scope = { region = italy_region } }
	}
	
	mean_time_to_happen = {
		months = 18	
	}
	
	option = {
		name = "italian_wars.3.a"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				VEN = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } }}
			}
			modifier = {
				factor = 5
				OR = {
					tag = HAB
					tag = HUN
					tag = TUR
				}
			}
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			VEN = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.b"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				MLO = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 }}} 
			}
			modifier = {
				factor = 5
				OR = {
					tag = HAB
					tag = FRA
					tag = CAS
					tag = ARA
					tag = SPA
					tag = SWI
				}
			}
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			MLO = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.c"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				GEN = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } }}
			}
			modifier = {
				factor = 5
				OR = {
					tag = FRA
					tag = ARA
					tag = CAS
					tag = SPA
					tag = POR
					tag = TUR
				}
			}
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			GEN = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.d1"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				SAV = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } }}
			}
			modifier = {
				factor = 5
				OR = {
					tag = FRA
					tag = SWI
					tag = HAB
				}
			}
		}
		trigger = {
			SAV = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } } }
			has_country_flag = IW_optin_1
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			SAV = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.e"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				LAN = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } }}
			}
			modifier = {
				factor = 5
				OR = {
					tag = HAB
					tag = HUN
					tag = ARA
					tag = CAS
					tag = SPA
				}
			}
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			LAN = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 } 
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.f"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				PAP = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 } }}
			}
			modifier = {
				factor = 5
				NOT = { religion = catholic }
			}
			modifier = {
				factor = 0
				religion = catholic
			}
		}
		hidden_effect = {
			set_country_flag = IW_outsider_1
			set_global_flag = IW_outsider_1_select
			ROOT = { save_global_event_target_as = IW_outsider_1 }
			PAP = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		}
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
	option = {
		name = "italian_wars.3.g"
		ai_chance = { 
			factor = 12
			modifier = {
				factor = 0 
				NAP = { NOT = { OR = { has_country_flag = IW_trigger_1  has_country_flag = IW_rival_1 }  } }
			}
			modifier = {
				factor = 5
				OR = {
					tag = HAB
					tag = CAS
					tag = ARA
					tag = TUR
					tag = FRA
					tag = SPA
					tag = AGV
					tag = ENG
				}
			}
		}
		set_country_flag = IW_outsider_1
		set_global_flag = IW_outsider_1_select
		ROOT = { save_global_event_target_as = IW_outsider_1 }
		NAP = { set_country_flag = IW_target_1 save_global_event_target_as = IW_target_1 }
		
		event_target:IW_trigger_1 = {
			country_event = { id = italian_wars.101 days = 1 }
		}
		every_country = {
			limit = { has_country_flag = IW_optin_1 }
			clr_country_flag = IW_optin_1
		}
	}
}


### 1st Italian War


country_event = {
	id = italian_wars.101
	title = "italian_wars.101.t"
	desc = "italian_wars.101.d"
	picture = DIPLOMACY_eventPicture
	
	#major = yes
	fire_only_once = yes
	
	trigger = {
		has_global_flag = IW_activate_1
		has_country_flag = IW_trigger_1
		is_year = 1490
		NOT = { is_year = 1560 }
	}
	
	mean_time_to_happen = {
		months = 18
	}
	
	option = {
		name = "italian_wars.101.a"
		event_target:IW_outsider_1 = {
			create_subject = {
				subject_type = league
				subject = event_target:IW_trigger_1
			}
			country_event = { id = italian_wars.102 days = 15 }
		}
		hidden_effect = {
			every_country = {
				limit = { has_country_flag = IW_trigger_1 }
				add_country_modifier = {
					name = "IW_participant_1"
					duration = -1
				}
			}
			every_country = {
				limit = { has_country_flag = IW_rival_1 }
				add_country_modifier = {
					name = "IW_participant_1"
					duration = -1
				}
			}
			every_country = {
				limit = { has_country_flag = IW_outsider_1 }
				add_country_modifier = {
					name = "IW_participant_1"
					duration = -1
				}	
			}
			every_country = {
				limit = { has_country_flag = IW_target_1 }
				add_country_modifier = {
					name = "IW_participant_1"
					duration = -1
				}
			}
		}
	}
}

country_event = {
	id = italian_wars.102
	title = "italian_wars.102.t"
	desc = "italian_wars.102.d"
	picture = BATTLE_eventPicture
	
	
	fire_only_once = yes
	is_triggered_only = yes
	major = yes
	
	option = {
		name = "italian_wars.102.a"
		hidden_effect = {
			add_casus_belli = {
				target = event_target:IW_target_1
				type = cb_fief
		 		months = 60
		 	}
		}
		declare_war_with_cb = {
			who = event_target:IW_target_1		
			casus_belli = cb_fief
		}
		ai_chance = { factor = 100 }
	}
}




country_event = {
	id = italian_wars.103
	title = "italian_wars.103.t"
	desc = "italian_wars.103.d"
	picture = BATTLE_eventPicture
	
	major = yes

	trigger = {
	 	has_country_flag = IW_outsider_1
		war_with = event_target:IW_target_1
		event_target:IW_target_1 = {
			capital_scope = {
				OR = {
					controlled_by = event_target:IW_outsider_1
					controlled_by = event_target:IW_trigger_1
				}
			}
		}
	}
	
	mean_time_to_happen = {
		days = 15
	}
	
	option = {
		name = "italian_wars.4.a"
		white_peace = event_target:IW_target_1
		create_subject = {
			subject_type = fief
			subject = event_target:IW_target_1
		}
		event_target:IW_rival_1 = { country_event = { id = italian_wars.104 days = 120 random = 30 } }
	}

}



#league of venice
country_event = {
	id = italian_wars.104
	title = "italian_wars.104.t"
	desc = "italian_wars.104.d"
	picture = DIPLOMACY_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "italian_wars.104.a"
		ai_chance = { factor = 100 }
		hidden_effect = {
			event_target:IW_trigger_1 = { 
				grant_independence = yes
			}
			event_target:IW_target_1 = {
				grant_independence = yes
			}
		}
		create_subject = {
			subject_type = league
			subject = event_target:IW_trigger_1
		}
		create_subject = {
			subject_type = league
			subject = event_target:IW_target_1
		}
		hidden_effect = {
			event_target:IW_target_1
				add_opinion = {
    				who = ROOT
   					modifier = italic_league
				}
			}
			event_target:IW_trigger_1
				add_opinion = {
    				who = ROOT
   					modifier = italic_league
				}
			}
		}
		event_target:IW_outsider_1 = { country_event = { id = italian_wars.105 days = 120 random = 30 } }
	}
	option = {
		name = "italian_wars.104.b"
		add_prestige = -25
		event_target:IW_outsider_1 = {
			add_country_modifier = {
				name = "IW_win_1"
				duration = 1825
			}
		}
		ai_chance = { factor = 0 }
	}
}

country_event = {
	id = italian_wars.105
	title = "italian_wars.105.t"
	desc = "italian_wars.105.d"
	picture = BATTLE_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "italian_wars.105.a"
		ai_chance = { factor = 100 }
		event_target:IW_rival_1 = {
			declare_war_with_cb = {
				who = event_target:IW_outsider_1		
				casus_belli = cb_italian_wars
			}
		}
		set_global_flag = IW_conflict_1
		capital_scope = {
			area = {
				limit = { is_core = event_target:IW_target_1 }
				change_controller = event_target:IW_outsider_1
			}
		}
	}
	option = {
		name = "italian_wars.105.b"
		add_prestige = -25
		event_target:IW_rival_1 = {
			add_country_modifier = {
				name = "IW_win_1"
				duration = 1825
			}
		}
		ai_chance = { factor = 0 }
	}
}

country_event = {
	id = italian_wars.150
	title = "italian_wars.150.t"
	desc = "italian_wars.150.d"
	picture = COURT_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	option = {
		name = "italian_wars.150.a"
		ai_chance = { factor = 100 }
		add_country_modifier = {
			name = "IW_win_1"
			duration = 1825
		}
		clr_global_flag = IW_conflict_1
	}
}


# 2nd Italian War


country_event = {
	id = italian_wars.7
	title = "italian_wars.7.t"
	desc = "italian_wars.7.d"
	picture = DIPLOMACY_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		MLO = { has_country_flag = IW_trigger_2 }
	}
	
	mean_time_to_happen = {
		months = 24
	}
	
	
	option = {
		name = "italian_wars.7.a"
		ai_chance = { factor = 100 }
		MLO = { grant_independence = yes }
		hidden_effect = {
			define_ruler = {
   				name = "Ludovico"
    			dynasty = "Sforza"
    			adm = 4
   				dip = 4
    			mil = 4
    			age = 45
    			claim = 95
    			culture = ROOT
    			religion = ROOT
    		}
			
		}
		set_global_flag = IW_activate_2
		
	}
}
country_event = {
	id = italian_wars.8
	title = "italian_wars.8.t"
	desc = "italian_wars.8.d"
	picture = DIPLOMACY_eventPicture
	
	major = yes
	is_triggered_only = yes
	
	trigger = {
		tag = FRA
		has_global_flag = IW_activate_2
	}
	
	
	mean_time_to_happen = {
		months = 24
	}
	
	
	option = {
		name = "italian_wars.8.a"
		ai_chance = { factor = 100 }
		create_subject = {
			subject_type = league
			subject = VEN
		}
	 	hidden_effect = {
		 	MLO = {
				add_country_modifier = {
					name = "IW_participant_2"
					duration = -1
				}
			}
			VEN = {
				add_country_modifier = {
					name = "IW_participant_2"
					duration = -1
				}
			}
		}
		declare_war_with_cb = {
			who = MLO			
			casus_belli = cb_restore_personal_union
		}
		add_country_modifier = {
			name = "IW_participant_2"
			duration = -1
		}
	}
}

country_event = {
	id = italian_wars.9
	title = "italian_wars.9.t"
	desc = "italian_wars.9.d"
	picture = BATTLE_eventPicture
	
	major = yes
	#is_triggered_only = yes
	trigger = {
		tag = FRA
		war_with = MLO
		104 = {
			OR = {
				controlled_by = ROOT
				controlled_by = VEN
			}
		}
		has_global_flag = IW_activate_2
	}
	
	mean_time_to_happen = {
		days = 1
		modifier = {
			factor = 0.01
			104 = { OR = { controlled_by = FRA controlled_by = VEN } }
		}
	}
	
	option = {
		name = "italian_wars.9.a"
		hidden_effect = {
			VEN = { white_peace = MLO }
			FRA = { white_peace = MLO }
		}
		FRA = {
			create_subject = {
				subject_type = fief
				subject = MLO
			}
		}
		MLO = { release = PAR }
		if = {
			limit = { 2979 = { owned_by = MLO } }
			2979 = { cede_province = SAV }
		}
		if = {
			limit = { 3054 = { owned_by = MLO } }
			3054 = { cede_province = SWI }
		}
		if = {
			limit = { 1862 = { owned_by = MLO } }
			1862 = { cede_province = VEN }
		}
		if = {
			limit = { 3294 = { owned_by = MLO } }
			3294 = { cede_province = VEN }
		}
		hidden_effect = {
			if = { 
				limit = { FRA = { overlord_of = NAP } }
				CAS = { country_event = { id = italian_wars.10 days = 45 } }
			}
			if = { 
				limit = { CAS = { overlord_of = NAP } }
				FRA = { country_event = { id = italian_wars.10 days = 45 } }
			}
		}
	}

}

country_event = {
	id = italian_wars.10
	title = "italian_wars.10.t"
	desc = "italian_wars.10.d"
	picture = DIPLOMACY_eventPicture
	
	#major = yes
	is_triggered_only = yes
	trigger = {
		OR = {
			AND = { 
				tag = CAS
				FRA = { overlord_of = NAP }
			}
			AND = { 
				tag = FRA
				CAS = { overlord_of = NAP }
			}
		}
		FRA = { overlord_of = MLO }
		has_global_flag = IW_activate_2
	}
	
	option = {
		name = "italian_wars.10.a" 
		ai_chance = { factor = 100 }
		if = { 
			limit = { tag = CAS }
			FRA = { country_event = { id = italian_wars.11 days = 45 } }
		}
		if = { 
			limit = { tag = FRA }
			CAS = { country_event = { id = italian_wars.11 days = 45 } }
		}
	}
	
	option = {
		name = "italian_wars.10.b" 
		ai_chance = { factor = 0 }
		add_prestige = -5
	}

}

country_event = {
	id = italian_wars.11
	title = "italian_wars.11.t"
	desc = "italian_wars.11.d"
	picture = DIPLOMACY_eventPicture
	
	#major = yes
	is_triggered_only = yes
	trigger = {
		has_global_flag = IW_activate_2
		overlord_of = NAP
	}
	
	
	option = {
		name = "italian_wars.11.a" 
		ai_chance = { factor = 100 }
		NAP = { release = CLB }
		add_prestige = -3
		FROM = { country_event = { id = italian_wars.12 days = 15 } }
	}
	
	option = {
		name = "italian_wars.11.b" 
		ai_chance = { factor = 0 }
		add_prestige = 3
	}

}

country_event = {
	id = italian_wars.12
	title = "italian_wars.12.t"
	desc = "italian_wars.12.d"
	picture = DIPLOMACY_eventPicture
	
	#major = yes
	is_triggered_only = yes
	trigger = {
		tag = CAS
		FRA = { overlord_of = MLO }
		has_global_flag = IW_activate_2
	}
	
	
	option = {
		name = "italian_wars.12.a" 
		ai_chance = { factor = 100 }
		create_union = CLB
		add_prestige = 5
		hidden_effect = {
			NAP = {
				add_country_modifier = { 
					name = "IW_participant_2"
					duration = -1
				}
			}
			CLB = {
				add_country_modifier = { 
					name = "IW_participant_2"
					duration = -1
				}
			}
			ARA = {
				add_country_modifier = { 
					name = "IW_participant_2"
					duration = -1
				}
			}
			CAS = {
				add_country_modifier = { 
					name = "IW_participant_2"
					duration = -1
				}
			}
		}
		FROM = { country_event = { id = italian_wars.12 days = 15 } }
	}
	
}