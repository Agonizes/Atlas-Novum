#Revenge for Varna -- the adaptation of 1448 battle at kosovo field
# Amyzonis

namespace = revenge_varna

#Hungary
country_event = {
	id = revenge_varna.1
	title = "revenge_varna.1.t"
	desc = "revenge_varna.1.d"
	picture = {
		picture = PEASANTS_ON_STEPPES_eventPicture
	}
	
	trigger = {
		tag = HUN
		is_year = 1448
		NOT = { has_leader = "(Regency Council)" }
		TUR = { is_at_war = no }
		POL = { is_at_war = no }
		is_at_war = no
		NOT = { has_global_flag = rv_activate }
		NOT = { has_country_modifier = rv_participant }
	}
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		days = 30
		modifier = { 
			factor = 0
			is_year = 1450	
		}
	}
	
	option = { #historical, push the infidel out of europe
		name = "revenge_varna.1.a"
		ai_chance = {
			factor = 99
		}
		#create_alliance = POL
		TUR = {
			country_event = {
				id = revenge_varna.2
				days = 15
			}
		}
		set_global_flag = rv_activate
	}
	option = { #
		name = "revenge_varna.1.b"
		ai_chance = {
			factor = 1
		}
		add_prestige = -10
		hidden_effect = {
			TUR = { 
				add_country_modifier = {
					name = "rv_win"
					duration = -1 
				}
			}
		}
	}
}

#turkish reaction to demand
country_event = {
	id = revenge_varna.2
	title = "revenge_varna.2.t"
	desc = "revenge_varna.2.d"
	picture = BORDER_TENSION_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	major = yes
	
	trigger = {
		has_global_flag = rv_activate
		tag = TUR
	}
	
	
	option = {
		ai_chance = {
			factor = 99
		}
		name = "revenge_varna.2.a"
		POL = { country_event = { id = revenge_varna.3 days = 13 } }
		HUN = { country_event = { id = revenge_varna.4 days = 15 } }
		TUR = { set_country_flag = turkish_rv_refusal }
	}
	option = {
		ai_chance = {
			factor = 1
		}
		name = "revenge_varna.2.b"
		add_prestige = -20
		WAL = { grant_independence = yes }
		SER = { grant_independence = yes }
		TUR = { set_country_flag = turkish_rv_acceptance }
	}
}


#Poland joins hungary
country_event = {
	id = revenge_varna.3
	title = "revenge_varna.3.t"
	desc = "revenge_varna.3.d"
	picture = DIPLOMACY_eventPicture
	
	trigger = {
		TUR = { has_country_flag = turkish_rv_refusal }
		has_global_flag = rv_activate
		tag = POL
	}
	
	is_triggered_only = yes
	#fire_only_once = yes
	
	option = {
		name = "revenge_varna.3.a"
		ai_chance = {
			factor = 90
		}
		HUN = {
			create_subject = {
				subject_type = league
				subject = POL
			}
		}
		add_country_modifier = {
			name = "rv_participant"
			duration = -1
		}
	}
	option = {
		ai_chance = {
			factor = 10
		}
		name = "revenge_varna.3.b"
		add_prestige = -5
	}
}

#attack ottomans
country_event = {
	id = revenge_varna.4
	title = "revenge_varna.4.t"
	desc = "revenge_varna.4.d"
	picture = HORDE_ON_HORSEBACK_eventPicture
	
	trigger = {
		TUR = { has_country_flag = turkish_rv_refusal }
		has_global_flag = rv_activate
		tag = HUN 
	}
	major = yes
	is_triggered_only = yes
	#fire_only_once = yes
	
	option = {
		name = "revenge_varna.4.a"
		declare_war_with_cb = {
			who = TUR
			casus_belli = cb_insult
		}
	#	hidden_effect = {
			HUN = { 
				add_country_modifier = {
					name = "rv_participant"
					duration = -1
				}
			}
			TUR = {
				add_country_modifier = {
					name = "rv_participant"
					duration = -1
				}
			}
	#	}
	}
}

#end war
country_event = {
	id = revenge_varna.100
	title = "revenge_varna.100.t"
	desc = "revenge_varna.100.d"
	picture = DIPLOMACY_eventPicture
	
	major = yes
	trigger = {
		has_global_flag = rv_activate
		has_country_modifier = rv_participant
		OR = {
			AND = {
				tag = TUR
				war_score_against = {
					who = HUN
					value = 10
				}
			}
			AND = {
				tag = HUN
				war_score_against = {
					who = TUR
					value = 10
				}
			}
		}
		NOT = { has_country_modifier = rv_win }
	}
	
	mean_time_to_happen = {
		months = 24
		modifier = {
			factor = 0.25
			OR = {
				4239 = { OR = { controlled_by = ROOT controlled_by = WAL controlled_by = SER } }
				1951 = { OR = { controlled_by = ROOT controlled_by = WAL controlled_by = SER } }
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				AND = {
					tag = TUR
					war_score_against = {
						who = HUN
						value = 25
					}
				}
				AND = {
					tag = HUN
					war_score_against = {
						who = TUR
						value = 25
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				AND = {
					tag = TUR
					war_score_against = {
						who = HUN
						value = 50
					}
				}
				AND = {
					tag = HUN
					war_score_against = {
						who = TUR
						value = 50
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				AND = {
					tag = TUR
					war_score_against = {
						who = HUN
						value = 75
					}
				}
				AND = {
					tag = HUN
					war_score_against = {
						who = TUR
						value = 75
					}
				}
			}
		}
		modifier = {
			factor = 0.5
			OR = {
				AND = {
					tag = TUR
					war_score_against = {
						who = HUN
						value = 90
					}
				}
				AND = {
					tag = HUN
					war_score_against = {
						who = TUR
						value = 90
					}
				}
			}
		}
	}
	
	fire_only_once = yes
	
	option = {
		name = "revenge_varna.100.a"
		trigger = {
			tag = TUR
			war_score_against = {
				who = HUN
				value = 10
			}
		}
		white_peace = HUN
		add_country_modifier = {
			name = "rv_win"
			duration = -1
		}
		hidden_effect = {
			every_country = { 
				limit = { has_country_modifier = rv_participant is_subject_of_type = league }
				grant_independence = yes
			}
			every_country = { 
				limit = { has_country_modifier = rv_participant }
				remove_country_modifier = rv_participant
			}
		}
	}
	option = {
		name = "revenge_varna.100.a"
		trigger = {
			tag = HUN
			war_score_against = {
				who = TUR
				value = 10
			}
		}
		white_peace = TUR
		add_country_modifier = {
			name = "rv_win"
			duration = -1
		}
		hidden_effect = {
			every_country = { 
				limit = { has_country_modifier = rv_participant is_subject_of_type = league }
				grant_independence = yes
			}
			every_country = { 
				limit = { has_country_modifier = rv_participant }
				remove_country_modifier = rv_participant
			}
		}
	}
}



