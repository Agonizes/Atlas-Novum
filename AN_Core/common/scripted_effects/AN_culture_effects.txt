AN_check_minorities = {
	hidden_effect = {
		if = {
			limit = { owner = { OR = { primary_culture = variable:PREV:AN_minority_culture accepted_culture = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { culture_group = variable:PREV:AN_minority_culture } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { culture_group = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_1
					duration = -1
				}
			}
		}
		#
		if = {
			limit = { owner = { religion = variable:PREV:AN_minority_religion } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { religion_group = variable:PREV:AN_minority_religion } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { religion_group = variable:PREV:AN_minority_religion } } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_1
					duration = -1
				}
			}
		}
		#
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_culture_size value = 1 } } }
			set_variable = { which = AN_minority_culture value = 0 }
			set_variable = { which = AN_minority_culture_size value = 0 }
			remove_province_modifier = AN_integrated_minority_culture_1
			remove_province_modifier = AN_integrated_minority_culture_2
			remove_province_modifier = AN_integrated_minority_culture_3
			remove_province_modifier = AN_coexisting_minority_culture_1
			remove_province_modifier = AN_coexisting_minority_culture_2
			remove_province_modifier = AN_coexisting_minority_culture_3
			remove_province_modifier = AN_oppressed_minority_culture_1
			remove_province_modifier = AN_oppressed_minority_culture_2
			remove_province_modifier = AN_oppressed_minority_culture_3
		}
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_religion_size value = 1 } } }
			set_variable = { which = AN_minority_religion value = 0 }
			set_variable = { which = AN_minority_religion_size value = 0 }
			remove_province_modifier = AN_true_faith_minority_religion_1
			remove_province_modifier = AN_true_faith_minority_religion_2
			remove_province_modifier = AN_true_faith_minority_religion_3
			remove_province_modifier = AN_heretic_minority_religion_1
			remove_province_modifier = AN_heretic_minority_religion_2
			remove_province_modifier = AN_heretic_minority_religion_3
			remove_province_modifier = AN_heathen_minority_religion_1
			remove_province_modifier = AN_heathen_minority_religion_2
			remove_province_modifier = AN_heathen_minority_religion_3
		}
	}
}

## CALC

AN_culture_calc = {
	hidden_effect = {
		change_variable = {
			which = AN_majority_progress
			value = $VAL$
		}
		change_variable = {
			which = AN_minority_progress
			value = $VAL$
		}
		if = {
			limit = { 
				check_variable = { which = AN_majority_progress value = 100 }
				check_variable = { which = AN_minority_progress value = 100 }
			}
			change_culture = variable:PREV:AN_target_culture
			set_variable = { which = AN_target_culture value = 0 }
			set_variable = { which = AN_majority_progress value = 0 }
			set_variable = { which = AN_minority_progress value = 0 }
		}
		
	}
}

### SET TARGET

AN_set_target_culture = {
	12000 = {
		change_culture = $CULTURE$
		export_to_variable = {
			variable_name = AN_target_culture
			value = culture
		}
		PREV = { set_variable = { which = AN_target_culture which = PREV } }
	}
}

AN_select_target_culture = {

	##### LATIN CHECKS #####
	if = {
		limit = { 
			OR = { 
				culture_group = latin 
				minority_culture_group = { CULTURE_GROUP=latin } 
			}
		}
		if = {
			limit = {
				OR = { 
					culture_group = south_slavic
					minority_culture_group = { CULTURE_GROUP=south_slavic }
					province_group = dalmatia_group
				}
			}
			AN_set_target_culture = { CULTURE=dalmatian }	
		}
		else_if = {
			limit = {
				OR = { 
					culture = cretan
					minority_culture = { CULTURE=cretan }
					area = eastern_mediterrenean_islands_area #Crete
				}
			}
			AN_set_target_culture = { CULTURE=candian }	
		}
		else_if = { 
			limit = {
				region = crimea_region
			}
			AN_set_target_culture = { CULTURE=gazarian }	
		}
		else_if = { 
			limit = {
				OR = { 
					culture_group = cypriot
					minority_culture = { CULTURE=cypriot }
					area = cyprus_area
				}
			}
			AN_set_target_culture = { CULTURE=cipriota }	
		}
		else_if = { 
			limit = {
				region = maghreb_region
			}
			AN_set_target_culture = { CULTURE=afri }	
		}
	}	
	####################
	
	##### IBERIAN CHECKS #####
	else_if = {
		limit = { 
			OR = { 
				culture_group = iberian 
				minority_culture_group = { CULTURE_GROUP=iberian } 
			}
		}
		if = { 
			limit = {
				area = macaronesia_area
			}
			AN_set_target_culture = { CULTURE=acoriano }	
		}
		#else_if = { 
		#	limit = {
		#		OR = { 
		#			culture = guanche
		#			minority_culture = { CULTURE=guanche }
		#			area = canaries_area
		#		}
		#	}
		#	AN_set_target_culture = { CULTURE=canary }	
		#}
		else_if = {
			limit = {
				OR = { 
					culture_group = central_american
					minority_culture_group = { CULTURE_GROUP=central_american }
					region = mexico_region
				}
			}
			AN_set_target_culture = { CULTURE=mexican }	
		}
		else_if = {
			limit = {
				OR = { 
					culture_group = central_american
					minority_culture_group = { CULTURE_GROUP=central_american }
					region = mexico_region
				}
			}
			AN_set_target_culture = { CULTURE=rioplatense }	
		}
		
		else_if = {
			limit = {
				OR = { 
					culture_group = andean_group
					minority_culture_group = { CULTURE_GROUP=andean_group }
					culture_group = aymara_g
					minority_culture_group = { CULTURE_GROUP=aymara_g }
					region = peru_region
					region = upper_peru_region
					region = colombia_region
					area = venezuela_andes_area
				}
			}
			AN_set_target_culture = { CULTURE=andino }	
		}
		else_if = {
			limit = {
				OR = {
					superregion = caribbean_superregion
					area = venezuela_area
					area = maracaibo_area	
				}
			}
			AN_set_target_culture = { CULTURE=caribeno }	
		}
		else_if = {
			limit = {
				region = central_america_region
			}
			AN_set_target_culture = { CULTURE=centroamericano }	
		}
		else_if = {
			limit = {
				OR = {
					area = eastern_llanos
					area = central_llanos_area
				}
			}
			AN_set_target_culture = { CULTURE=llanero }	
		}
		#criollo
		#chavacano
		else_if = {
			limit = {
				superregion = brazil_superregion
			}
			AN_set_target_culture = { CULTURE=brazilian }	
		}
		else_if = {
			limit = {
				superregion = amazon_superregion
			}
			AN_set_target_culture = { CULTURE=amazonic }	
		}
		else_if = {
			limit = {
				OR = {
					culture = flores
					minority_culture = { CULTURE=flores }
					area = flores_area
				}
			}
			AN_set_target_culture = { CULTURE=topasse }	
		}
	}	
	####################
}



### MINORITY INTERACTIONS

AN_set_minority_culture = {
	custom_tooltip = AN_$CULTURE$_$SIZE$_minority.tooltip
	if = {
		limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
		custom_tooltip = AN_set_minority_culture_replace.tooltip
	}
	hidden_effect = {
		12000 = { 
			change_culture = $CULTURE$ 
			export_to_variable = {
				variable_name = AN_minority_culture
				value = culture
			}
			PREV = { 
				set_variable = { which = AN_minority_culture which = PREV } 
				set_variable = { which = AN_minority_culture_size value = $SIZE$ } 
			}
		}
	}
	AN_check_minorities = yes
}

AN_increase_minority_culture_size = {
	hidden_effect = { change_variable = { which = AN_minority_culture_size value = 1 } }
	if = {
		limit = { check_variable = { which = AN_minority_culture_size value = 4 } }
		change_culture = variable:PREV:AN_minority_culture
		hidden_effect = {
			set_variable = {
				which = AN_minority_culture
				which = AN_province_culture
			}
			set_variable = { which = AN_minority_culture_size value = 3 }
		}
		custom_tooltip = AN_change_minority_culture_size_swap.tooltip
	}
	else = {
		custom_tooltip = AN_change_minority_culture_size_i.tooltip
	}
	AN_check_minorities = yes
}

AN_decrease_minority_culture_size = {
	custom_tooltip = AN_change_minority_culture_size_d.tooltip
	hidden_effect = { change_variable = { which = AN_minority_culture_size value = -1 } }
	AN_check_minorities = yes
}

AN_remove_minority_culture = {
	custom_tooltip = AN_remove_minority_culture.tooltip
	hidden_effect = { set_variable = { which = AN_minority_culture_size value = 0 } }
	AN_check_minorities = yes
}

AN_set_minority_religion = {
	custom_tooltip = AN_$RELIGION$_$SIZE$_minority.tooltip
	if = {
		limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
		custom_tooltip = AN_set_minority_religion_replace.tooltip
	}
	hidden_effect = {
		12000 = { 
			change_religion = $RELIGION$ 
			export_to_variable = {
				variable_name = AN_minority_religion
				value = religion
			}
			PREV = { 
				set_variable = { which = AN_minority_religion which = PREV } 
				set_variable = { which = AN_minority_religion_size value = $SIZE$ } 
				
			}
		}
	}
	AN_check_minorities = yes
}

AN_increase_minority_religion_size = {
	hidden_effect = { change_variable = { which = AN_minority_religion_size value = 1 } }
	if = {
		limit = { check_variable = { which = AN_minority_religion_size value = 4 } }
		change_religion = variable:PREV:AN_minority_religion
		hidden_effect = {
			set_variable = {
				which = AN_minority_religion
				which = AN_province_religion
			}	
			set_variable = { which = AN_minority_religion_size value = 3 }
		}
		custom_tooltip = AN_change_minority_religion_size_swap.tooltip
	}
	else = {
		custom_tooltip = AN_change_minority_religion_size_i.tooltip
	}
	AN_check_minorities = yes
}

AN_decrease_minority_religion_size = {
	custom_tooltip = AN_change_minority_religion_size_d.tooltip
	hidden_effect = { change_variable = { which = AN_minority_religion_size value = -1 } }
	AN_check_minorities = yes
}

AN_remove_minority_religion = {
	custom_tooltip = AN_remove_minority_religion.tooltip
	hidden_effect = { set_variable = { which = AN_minority_religion_size value = 0 } }
	AN_check_minorities = yes
}
