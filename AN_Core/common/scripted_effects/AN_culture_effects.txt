AN_check_minorities = {
	hidden_effect = {
		export_to_variable = {
			variable_name = AN_province_culture
			value = culture
		}
		export_to_variable = {
			variable_name = AN_province_religion
			value = religion
		}
		if = {
			limit = { owner = { OR = { primary_culture = variable:PREV:AN_minority_culture accepted_culture = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { culture_group = variable:PREV:AN_minority_culture } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { culture_group = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_1
					duration = -1
				}
			}
		}
		#
		if = {
			limit = { owner = { religion = variable:PREV:AN_minority_religion } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { religion_group = variable:PREV:AN_minority_religion } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { religion_group = variable:PREV:AN_minority_religion } } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_1
					duration = -1
				}
			}
		}
		#
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_culture_size value = 1 } } }
			set_variable = { which = AN_minority_culture value = 0 }
			set_variable = { which = AN_minority_culture_size value = 0 }
			remove_province_modifier = AN_integrated_minority_culture_1
			remove_province_modifier = AN_integrated_minority_culture_2
			remove_province_modifier = AN_integrated_minority_culture_3
			remove_province_modifier = AN_coexisting_minority_culture_1
			remove_province_modifier = AN_coexisting_minority_culture_2
			remove_province_modifier = AN_coexisting_minority_culture_3
			remove_province_modifier = AN_oppressed_minority_culture_1
			remove_province_modifier = AN_oppressed_minority_culture_2
			remove_province_modifier = AN_oppressed_minority_culture_3
		}
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_religion_size value = 1 } } }
			set_variable = { which = AN_minority_religion value = 0 }
			set_variable = { which = AN_minority_religion_size value = 0 }
			remove_province_modifier = AN_true_faith_minority_religion_1
			remove_province_modifier = AN_true_faith_minority_religion_2
			remove_province_modifier = AN_true_faith_minority_religion_3
			remove_province_modifier = AN_heretic_minority_religion_1
			remove_province_modifier = AN_heretic_minority_religion_2
			remove_province_modifier = AN_heretic_minority_religion_3
			remove_province_modifier = AN_heathen_minority_religion_1
			remove_province_modifier = AN_heathen_minority_religion_2
			remove_province_modifier = AN_heathen_minority_religion_3
		}
	}
}

## CALC

AN_culture_calc = {
	hidden_effect = {
		if = {
			limit = { 
				check_variable = { which = AN_target_culture value = 1 } 
				NOT = { nationalism = 1 }
			}
			if = { 
				limit = { 
					OR = { 
						has_owner_culture = yes
						has_owner_accepted_culture = yes
					}
					NOT = { OR = { has_province_flag = AN_int_maj has_province_flag = AN_acc_min has_province_flag = AN_suppress_min has_province_flag = AN_expel_min }  }
				}
				if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
					change_variable = {
						which = AN_majority_progress
						value = 3
					}
				}
				else_if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
					change_variable = {
						which = AN_majority_progress
						value = 2
					}
				}
				else_if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
					change_variable = {
						which = AN_majority_progress
						value = 1
					}
				}
				else = {
					change_variable = {
						which = AN_majority_progress
						value = 0.5
					}
				}
			}
			else_if = { 
				limit = { 
					OR = { 
						has_owner_culture = no
						has_owner_accepted_culture = no
					}
					NOT = { OR = { has_province_flag = AN_int_min has_province_flag = AN_acc_maj has_province_flag = AN_suppress_maj has_province_flag = AN_expel_maj }  }
				}
				if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
					change_variable = {
						which = AN_minority_progress
						value = 3
					}
				}
				else_if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
					change_variable = {
						which = AN_minority_progress
						value = 2
					}
				}
				else_if = { 
					limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
					change_variable = {
						which = AN_minority_progress
						value = 1
					}
				}
				else = {
					change_variable = {
						which = AN_minority_progress
						value = 0.5
					}
				}
			}
		}
		trigger_switch = {
			on_trigger = has_province_flag
			#
			AN_int_maj = {
				change_variable = {
					which = AN_majority_progress
					value = 101 #test
				}
			}
			AN_int_min = {
				change_variable = {
					which = AN_minority_progress
					value = 101 #test
				}
			}
			#
			AN_acc_maj = {
				change_variable = {
					which = AN_majority_progress
					value = 101 #test
				}
			}
			AN_acc_min = {
				change_variable = {
					which = AN_minority_progress
					value = 101 #test
				}
			}
			#
		}
		### CHECK 0 - 100 results
		if = {
			limit = { check_variable = { which = AN_majority_progress value = 100 } }
			if = { 
				limit = { OR = { has_province_flag = AN_int_maj has_province_flag = AN_acc_maj } }
				trigger_switch = {
					on_trigger = has_province_flag
					#
					AN_int_maj = {
						change_culture = owner 
					}
					#
					AN_acc_maj = {
						owner = { add_accepted_culture = variable:PREV:AN_province_culture  }
					}
				}
			}
			else = {
				if = { 
					limit = { NOT = { is_variable_equal = { which = AN_province_culture which = AN_target_culture } } }
					change_culture = variable:AN_target_culture
					set_variable = {
						which = AN_province_culture
						which = AN_target_culture
					}
				}
				subtract_variable = { which = AN_minority_culture_size value = 1 } 
				AN_check_minorities = yes 
			}
			set_variable = { which = AN_majority_progress value = 0 }
		}
		else_if = { 
			limit = { NOT = { check_variable = { which = AN_majority_progress value = 0 } } }
			set_variable = { which = AN_majority_progress value = 0 }
		}
		######################
		if = { 
			limit = { check_variable = { which = AN_minority_progress value = 100 } }
			if = { 
				limit = { OR = { has_province_flag = AN_int_min has_province_flag = AN_acc_min } }
				trigger_switch = {
					on_trigger = has_province_flag
					#
					AN_int_min = {
						owner = { 
							set_variable = { which = AN_minority_culture = 0 }
							export_to_variable = {
								variable_name = AN_minority_culture
								value = primary_culture
							}
						}
						set_variable = { which = AN_minority_culture which = owner }
					}
					#
					AN_acc_min = {
						owner = { add_accepted_culture = variable:PREV:AN_minority_culture }
						
					}
				}
				AN_check_minorities = yes
			}
			else = {
				if = { 
					limit = { NOT = { is_variable_equal = { which = AN_minority_culture which = AN_target_culture } } }
					set_variable = { which = AN_minority_culture which = AN_target_culture }
				}
				if = {
					limit = { check_variable = { which = AN_minority_culture_size value = 3 } } 
					change_culture = variable:AN_minority_culture
					set_variable = {
						which = AN_minority_culture
						which = AN_province_culture
					}
				}
				else = { 
					change_variable = { which = AN_minority_culture_size value = 1 } 
				}
				AN_check_minorities = yes 
			}
			set_variable = { which = AN_minority_progress value = 0 }
		}
		else_if = { 
			limit = { NOT = { check_variable = { which = AN_minority_progress value = 0 } } }
			set_variable = { which = AN_minority_progress value = 0 }
		}
	}
}

### SET TARGET

AN_check_culture_process = {
	if = { 
		limit = { 
			OR = {
				AND = {
					OR = {
						has_province_modifier = AN_oppressed_minority_culture_1
						has_province_modifier = AN_oppressed_minority_culture_2
						has_province_modifier = AN_oppressed_minority_culture_3
					}
					OR = {
						has_owner_culture = yes
						has_owner_accepted_culture = yes
					}
					NOT = { has_province_flag = AN_int_maj }
					NOT = { OR = { has_province_flag = AN_suppress_min has_province_flag = AN_expel_min } }
				}
				AND = {
					OR = {
						has_province_modifier = AN_integrated_minority_culture_1
						has_province_modifier = AN_integrated_minority_culture_2
						has_province_modifier = AN_integrated_minority_culture_3
						has_province_modifier = AN_coexisting_minority_culture_1
						has_province_modifier = AN_coexisting_minority_culture_2
						has_province_modifier = AN_coexisting_minority_culture_3
					}
					has_owner_culture = no
					has_owner_accepted_culture = no
					NOT = { has_province_flag = AN_int_min }
					NOT = { OR = { has_province_flag = AN_suppress_maj has_province_flag = AN_expel_maj } }
				}
			}
		} 
		AN_select_target_culture = yes
	}
}

AN_integrate_majority_culture = { 
	12000 = { 
		set_variable = { which = AN_province_culture which = PREV }
		set_variable = { which = AN_minority_culture which = AN_province_culture }
	}
	owner = {
		every_owned_province = {
			limit = {
				OR = {
					is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV }
					is_variable_equal = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
				}
			}
			if = { 
				limit = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } }
				set_province_flag = AN_int_maj
				set_variable = { which = AN_majority_progress value = 0 }
			}
			else = {
				set_province_flag = AN_int_min
				set_variable = { which = AN_minority_progress value = 0 }
			}
		}
	}
}

AN_integrate_minority_culture = { 
	12000 = { 
		set_variable = { which = AN_minority_culture which = PREV }
		set_variable = { which = AN_province_culture which = AN_minority_culture }
	}
	owner = {
		every_owned_province = {
			limit = {
				OR = {
					is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV }
					is_variable_equal = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
				}
			}
			if = { 
				limit = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } }
				set_province_flag = AN_int_maj
				set_variable = { which = AN_majority_progress value = 0 }
			}
			else = {
				set_province_flag = AN_int_min
				set_variable = { which = AN_minority_progress value = 0 }
			}
		}
	}
}

AN_accept_majority_culture = { 
	12000 = { 
		set_variable = { which = AN_province_culture which = PREV }
		set_variable = { which = AN_minority_culture which = AN_province_culture }
	}
	owner = {
		every_owned_province = {
			limit = {
				OR = {
					is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV }
					is_variable_equal = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
				}
			}
			if = { 
				limit = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } }
				set_province_flag = AN_acc_maj
				set_variable = { which = AN_majority_progress value = 0 }
			}
			else = {
				set_province_flag = AN_acc_min
				set_variable = { which = AN_minority_progress value = 0 }
			}
		}
	}
}

AN_accept_minority_culture = { 
	12000 = { 
		set_variable = { which = AN_minority_culture which = PREV }
		set_variable = { which = AN_province_culture which = AN_minority_culture }
	}
	owner = {
		every_owned_province = {
			limit = {
				OR = {
					is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV }
					is_variable_equal = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
				}
			}
			if = { 
				limit = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } }
				set_province_flag = AN_acc_maj
				set_variable = { which = AN_majority_progress value = 0 }
			}
			else = {
				set_province_flag = AN_acc_min
				set_variable = { which = AN_minority_progress value = 0 }
			}
		}
	}
}

AN_set_target_culture = {
	12000 = {
		change_culture = $CULTURE$
		export_to_variable = {
			variable_name = AN_target_culture
			value = culture
		}
		PREV = { set_variable = { which = AN_target_culture which = PREV } }
	}
}

AN_select_target_culture = {

	##### LATIN CHECKS #####
	if = {
		limit = { 
			OR = { 
				culture_group = latin 
				minority_culture_group = { CULTURE_GROUP=latin } 
			}
		}
		#if = {
		#	limit = {
		#		OR = { 
		#			culture_group = south_slavic
		#			minority_culture_group = { CULTURE_GROUP=south_slavic }
		#			province_group = dalmatia_group
		#		}
		#	}
		#	AN_set_target_culture = { CULTURE=dalmatian }	
		#}
		if = {
			limit = {
				OR = { 
					culture = maltensi
					minority_culture = { CULTURE=maltensi }
				}
			}
			AN_set_target_culture = { CULTURE=maltese }		
		}
		else_if = {
			limit = {
				OR = { 
					culture = cretan
					minority_culture = { CULTURE=cretan }
					area = eastern_mediterrenean_islands_area #Crete
				}
			}
			AN_set_target_culture = { CULTURE=candian }	
		}
		else_if = { 
			limit = {
				region = crimea_region
			}
			AN_set_target_culture = { CULTURE=gazarian }	
		}
		else_if = { 
			limit = {
				OR = { 
					culture_group = cypriot
					minority_culture = { CULTURE=cypriot }
					area = cyprus_area
				}
			}
			AN_set_target_culture = { CULTURE=cipriota }	
		}
		else_if = { 
			limit = {
				region = maghreb_region
			}
			AN_set_target_culture = { CULTURE=afri }	
		}
		else = {
			remove_province_flag = AN_assimil_maj
			remove_province_flag = AN_assimil_min
		}
	}	
	####################
	
	##### IBERIAN CHECKS #####
	else_if = {
		limit = { 
			OR = { 
				culture_group = iberian 
				minority_culture_group = { CULTURE_GROUP=iberian } 
			}
		}
		if = { 
			limit = {
				area = macaronesia_area
			}
			AN_set_target_culture = { CULTURE=acoriano }	
		}
		else_if = { 
			limit = {
				OR = { 
				culture = guanche
					minority_culture = { CULTURE=guanche }
					area = canaries_area
				}
			}
			AN_set_target_culture = { CULTURE=canary }	
		}
		else_if = {
			limit = {
				OR = { 
					culture_group = central_american
					minority_culture_group = { CULTURE_GROUP=central_american }
					region = mexico_region
				}
			}
			AN_set_target_culture = { CULTURE=mexican }	
		}
		else_if = {
			limit = {
				OR = { 
					culture_group = central_american
					minority_culture_group = { CULTURE_GROUP=central_american }
					region = mexico_region
				}
			}
			AN_set_target_culture = { CULTURE=rioplatense }	
		}
		
		else_if = {
			limit = {
				OR = { 
					culture_group = andean_group
					minority_culture_group = { CULTURE_GROUP=andean_group }
					culture_group = aymara_g
					minority_culture_group = { CULTURE_GROUP=aymara_g }
					region = peru_region
					region = upper_peru_region
					region = colombia_region
					area = venezuela_andes_area
				}
			}
			AN_set_target_culture = { CULTURE=andino }	
		}
		else_if = {
			limit = {
				OR = {
					superregion = caribbean_superregion
					area = venezuela_area
					area = maracaibo_area	
				}
			}
			AN_set_target_culture = { CULTURE=caribeno }	
		}
		else_if = {
			limit = {
				region = central_america_region
			}
			AN_set_target_culture = { CULTURE=centroamericano }	
		}
		else_if = {
			limit = {
				OR = {
					area = eastern_llanos
					area = central_llanos_area
				}
			}
			AN_set_target_culture = { CULTURE=llanero }	
		}
		#criollo
		#chavacano
		else_if = {
			limit = {
				superregion = brazil_superregion
			}
			AN_set_target_culture = { CULTURE=brazilian }	
		}
		else_if = {
			limit = {
				superregion = amazon_superregion
			}
			AN_set_target_culture = { CULTURE=amazonic }	
		}
		else_if = {
			limit = {
				OR = {
					culture = flores
					minority_culture = { CULTURE=flores }
					area = flores_area
				}
			}
			AN_set_target_culture = { CULTURE=topasse }	
		}
		else = {
			remove_province_flag = AN_assimil_maj
			remove_province_flag = AN_assimil_min
		}
	}	
	####################
	
	
	####################
	else = {
		remove_province_flag = AN_assimil_maj
		remove_province_flag = AN_assimil_min
	}
}



### MINORITY INTERACTIONS

AN_set_minority_culture = {
	custom_tooltip = AN_$CULTURE$_$SIZE$_minority.tooltip
	if = {
		limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
		custom_tooltip = AN_set_minority_culture_replace.tooltip
	}
	hidden_effect = {
		12000 = { 
			change_culture = $CULTURE$ 
			export_to_variable = {
				variable_name = AN_minority_culture
				value = culture
			}
			PREV = { 
				set_variable = { which = AN_minority_culture which = PREV } 
				set_variable = { which = AN_minority_culture_size value = $SIZE$ } 
			}
		}
	}
	AN_check_minorities = yes
}

AN_increase_minority_culture_size = {
	hidden_effect = { change_variable = { which = AN_minority_culture_size value = 1 } }
	if = {
		limit = { check_variable = { which = AN_minority_culture_size value = 4 } }
		change_culture = variable:PREV:AN_minority_culture
		hidden_effect = {
			set_variable = {
				which = AN_minority_culture
				which = AN_province_culture
			}
			set_variable = { which = AN_minority_culture_size value = 3 }
		}
		custom_tooltip = AN_change_minority_culture_size_swap.tooltip
	}
	else = {
		custom_tooltip = AN_change_minority_culture_size_i.tooltip
	}
	AN_check_minorities = yes
}

AN_decrease_minority_culture_size = {
	custom_tooltip = AN_change_minority_culture_size_d.tooltip
	hidden_effect = { change_variable = { which = AN_minority_culture_size value = -1 } }
	AN_check_minorities = yes
}

AN_remove_minority_culture = {
	custom_tooltip = AN_remove_minority_culture.tooltip
	hidden_effect = { set_variable = { which = AN_minority_culture_size value = 0 } }
	AN_check_minorities = yes
}

AN_set_minority_religion = {
	custom_tooltip = AN_$RELIGION$_$SIZE$_minority.tooltip
	if = {
		limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
		custom_tooltip = AN_set_minority_religion_replace.tooltip
	}
	hidden_effect = {
		12000 = { 
			change_religion = $RELIGION$ 
			export_to_variable = {
				variable_name = AN_minority_religion
				value = religion
			}
			PREV = { 
				set_variable = { which = AN_minority_religion which = PREV } 
				set_variable = { which = AN_minority_religion_size value = $SIZE$ } 
				
			}
		}
	}
	AN_check_minorities = yes
}

AN_increase_minority_religion_size = {
	hidden_effect = { change_variable = { which = AN_minority_religion_size value = 1 } }
	if = {
		limit = { check_variable = { which = AN_minority_religion_size value = 4 } }
		change_religion = variable:PREV:AN_minority_religion
		hidden_effect = {
			set_variable = {
				which = AN_minority_religion
				which = AN_province_religion
			}	
			set_variable = { which = AN_minority_religion_size value = 3 }
		}
		custom_tooltip = AN_change_minority_religion_size_swap.tooltip
	}
	else = {
		custom_tooltip = AN_change_minority_religion_size_i.tooltip
	}
	AN_check_minorities = yes
}

AN_decrease_minority_religion_size = {
	custom_tooltip = AN_change_minority_religion_size_d.tooltip
	hidden_effect = { change_variable = { which = AN_minority_religion_size value = -1 } }
	AN_check_minorities = yes
}

AN_remove_minority_religion = {
	custom_tooltip = AN_remove_minority_religion.tooltip
	hidden_effect = { set_variable = { which = AN_minority_religion_size value = 0 } }
	AN_check_minorities = yes
}
