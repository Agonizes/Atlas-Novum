# CLIMATE
AN_check_climate = {
	hidden_effect = {
		set_variable = { which = AN_prov_climate value = 0 }
		if = {
			limit = { has_global_flag = AN_global_climate_A }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 3 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 9 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 5 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_0 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 4 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 3 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_1 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 5 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 9 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 2 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_2 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 4 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 1 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_3 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 3 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 0 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_4 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 2 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 0 } }
			}
		}
		#for dynamic localization purposes
		change_variable = {
			which = AN_prov_climate
			which = AN_prov_pop_cap
		}
	}
}


# DEVELOPMENT
AN_check_dev_variables = {
	hidden_effect = {
		set_variable = { which = AN_wealth_production value = 0 }
		set_variable = { which = AN_wealth_growth value = 0 }
		set_variable = { which = AN_pop_production value = 0 }
		set_variable = { which = AN_pop_growth value = 0 }
		set_variable = { which = AN_logistics value = 0 }
		set_variable = { which = AN_consumption value = 0 }
		set_variable = { which = AN_prov_pop value = 0 }
		set_variable = { which = AN_prov_infrastructure value = 0 }
		set_variable = { which = AN_prov_infrastructure_cap value = 0 }
		set_variable = { which = AN_prov_wealth value = 0 }
		set_variable = { which = AN_migration_factor value = 0 }
		set_variable = { which = AN_migration_growth value = 0 }
		

		#EXPORT DEV FOR CHECKS
		export_to_variable = {
			variable_name = AN_logistics
			value = modifier:local_development_cost
		}
		export_to_variable = {
			variable_name = AN_prov_infrastructure
			value = trigger_value:base_production
		}
		export_to_variable = {
			variable_name = AN_prov_pop
			value = trigger_value:base_manpower
		}
		export_to_variable = {
			variable_name = AN_prov_wealth
			value = trigger_value:base_tax
		}
		###
		export_to_variable = {
			variable_name = AN_province_culture
			value = culture
		}
		export_to_variable = {
			variable_name = AN_province_religion
			value = religion
		}
		###
		if = { #-99.9% is the max negative consumption cost
			limit = {
				NOT = { check_variable = { which = AN_logistics value = 0.001 } }
			}
			set_variable = { which = AN_logistics value = 0.001 }
		}
		change_variable = {
			which = AN_consumption
			which = AN_logistics
		}
		multiply_variable = {
			which = AN_consumption
			which = AN_prov_pop
		}
		###
		AN_check_climate = yes
		###
		change_variable = {
			which = AN_wealth_production
			which = AN_prov_wealth
		}
		multiply_variable = {
			which = AN_wealth_production
			value = 0.5
		}
		change_variable = {
			which = AN_pop_production
			which = AN_prov_infrastructure
		}
		multiply_variable = {
			which = AN_pop_production
			value = 0.5
		}
		#############
		# TRIGGER SWITCH FOR Terrain contribution to Carrying Capacity & Growth
		trigger_switch = {
			on_trigger = has_terrain
			farmlands = { 
				change_variable = { which = AN_wealth_production value = 12 } 
				change_variable = { which = AN_pop_production value = 12 } 
				change_variable = { which = AN_prov_pop_cap value = 8 }
				change_variable = { which = AN_prov_infrastructure_cap value = 8 }
			}
			grasslands = { 
				change_variable = { which = AN_wealth_production value = 10 } 
				change_variable = { which = AN_pop_production value = 10 } 
				change_variable = { which = AN_prov_pop_cap value = 6 }
				change_variable = { which = AN_prov_infrastructure_cap value = 6 }
			}
			drylands = { 
				change_variable = { which = AN_wealth_production value = 9 } 
				change_variable = { which = AN_pop_production value = 9 } 
				change_variable = { which = AN_prov_pop_cap value = 6 }
				change_variable = { which = AN_prov_infrastructure_cap value = 6 }
			}
			#
			woods = { 
				change_variable = { which = AN_wealth_production value = 8 } 
				change_variable = { which = AN_pop_production value = 8 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			marsh = { 
				change_variable = { which = AN_wealth_production value = 8 } 
				change_variable = { which = AN_pop_production value = 6 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			hills = { 
				change_variable = { which = AN_wealth_production value = 5 } 
				change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			#
			jungle = { 
				change_variable = { which = AN_wealth_production value = 5 } 
				change_variable = { which = AN_pop_production value = 6 } 
				change_variable = { which = AN_prov_pop_cap value = 4 } 
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			coastline = { 
				change_variable = { which = AN_wealth_production value = 6 } 
				change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			steppe = { 
				change_variable = { which = AN_wealth_production value = 4 } 
				change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			#
			highlands = { 
				change_variable = { which = AN_wealth_production value = 3 } 
				change_variable = { which = AN_pop_production value = 4 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 3 }
			}
			savannah = { 
				change_variable = { which = AN_wealth_production value = 3 } 
				change_variable = { which = AN_pop_production value = 4 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			coastal_desert = { 
				change_variable = { which = AN_wealth_production value = 4 } 
				change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			#
			forest = { 
				change_variable = { which = AN_wealth_production value = 3 } 
				change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 3 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			mountain = { 
				change_variable = { which = AN_wealth_production value = 3 } 
				change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 3 } 
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			badlands = { 
				change_variable = { which = AN_wealth_production value = 2 } 
				change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			#
			tundra = { 
				change_variable = { which = AN_wealth_production value = 2 } 
				change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			desert = { 
				change_variable = { which = AN_wealth_production value = 3 } 
				change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			glacier = { 
				change_variable = { which = AN_wealth_production value = 1 } 
				change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
		}
		
		## terrain features
		trigger_switch = { # non-stackable features
			on_trigger = has_province_modifier
			atoll = {
				change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			barrier_islands = {
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			cliff = {
				subtract_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			canyon = {
				change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			cove = {
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			valley = {
				change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			fjord = {
				change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			plateau = {
				change_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			wadi = {
				change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
			}
			oasis = {
				change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			volcano = {
				change_variable = { which = AN_prov_pop_cap value = 3 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			doab = {
				change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 3 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
		}
		# stackable features
		if = {
			limit = { has_province_modifier = marsh_feature }
			subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = swamp }
			subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 2 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = bog }
			subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 3 }
		}
		if = {
			limit = { has_province_modifier = bayou }
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = floodplain }
			change_variable = { which = AN_pop_production value = 4 } 
			change_variable = { which = AN_prov_pop_cap value = 2 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = lakeshore }
			change_variable = { which = AN_pop_production value = 1 } 
			change_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		

		## infr prj
		if = {
			limit = { has_province_modifier = irrigation }
			change_variable = { which = AN_pop_production value = 6 } 
			change_variable = { which = AN_prov_pop_cap value = 2 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = gardens }
			change_variable = { which = AN_pop_production value = 2 } 
			change_variable = { which = AN_prov_pop_cap value = 3 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = wells }
			change_variable = { which = AN_pop_production value = 4 } 
			change_variable = { which = AN_prov_pop_cap value = 4 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = terrace }
			change_variable = { which = AN_pop_production value = 3 } 
			change_variable = { which = AN_prov_pop_cap value = 3 }
			change_variable = { which = AN_prov_infrastructure_cap value = 3 }
		}
		if = {
			limit = { has_province_modifier = dikes }
			change_variable = { which = AN_prov_pop_cap value = 5 }
			change_variable = { which = AN_prov_infrastructure_cap value = 5 }
		}
		if = {
			limit = { has_province_modifier = breakwaters } 
			change_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = lighthouse }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = dam }
			change_variable = { which = AN_pop_production value = 2 } 
			change_variable = { which = AN_prov_pop_cap value = 4 }
			change_variable = { which = AN_prov_infrastructure_cap value = 4 }
		}
		
		##
		
		#Migration		
		trigger_switch = { 
			on_trigger = has_building
			village = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 4 }
				change_variable = { which = AN_prov_pop_cap  value = 4 }
				change_variable = { which = AN_migration_factor value = 1 }
			}
			town = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 8 }
				change_variable = { which = AN_prov_pop_cap  value = 8 }
				change_variable = { which = AN_migration_factor value = 2 }
			}
			city = {
				change_variable = { which = AN_prov_infrastructure_cap  value = 12 }
				change_variable = { which = AN_prov_pop_cap  value = 12 }
				change_variable = { which = AN_migration_factor value = 3 }
			} 
			metropolis = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 16 }
				change_variable = { which = AN_prov_pop_cap  value = 16 }
				change_variable = { which = AN_migration_factor value = 4 }
			}
		}
		
		change_variable = {
			which = AN_migration_factor
			which = AN_prov_pop_cap
		}
		subtract_variable = {
			which = AN_migration_factor
			which = AN_prov_pop
		}
		
		
		if = {
			limit = { NOT = { check_variable = { which = AN_migration_factor value = 0 } } }
			multiply_variable = {
				which = AN_migration_factor
				value = 3
			}
		}	
		else_if = {
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			multiply_variable = {
				which = AN_migration_factor
				value = 0.35
			}
		}
		multiply_variable = { #
			which = AN_prov_wealth
			value = 0.15
		}
		change_variable = { #export to migration factor
			which = AN_migration_factor
			which = AN_prov_wealth
		}
		divide_variable = { #RESET
			which = AN_prov_wealth
			value = 0.15
		}
		
		#Buildings
		#Urban
		if = {
			limit = { NOT = { OR = { has_building = village has_building = town has_building = city has_building = metropolis } } }
			subtract_variable = { which = AN_migration_factor value = 2 }
		}
		if = {
			limit = { is_capital = yes }
			change_variable = { which = AN_migration_factor value = 1 }
		}
		if = {
			limit = { NOT = { base_manpower = 2 } }
			change_variable = { which = AN_migration_factor value = 3 }
		}
	
		#Census View
		change_variable = {
			which = AN_pop_growth
			which = AN_pop_production
		}
		subtract_variable = {
			which = AN_pop_growth
			which = AN_consumption
		}
		change_variable = {
			which = AN_wealth_growth
			which = AN_wealth_production
		}	
		divide_variable = {
			which = AN_wealth_growth
			which = AN_logistics
		}		
		
		if = { 
			limit = { check_variable = { which = AN_pop_growth value = 0 } }
			change_variable = {
				which = AN_migration_growth
				which = AN_pop_growth
			}
			if = { limit = { OR = { has_building = farm_estate has_building = fishery has_building = plantations has_building = mills has_building = orchard has_building = pasture has_building = mine has_building = quarry has_building = lodge } }
				multiply_variable = {
					which = AN_pop_growth
					value = 0.25
				}
				multiply_variable = {
					which = AN_migration_growth
					value = 0.75
				}
			}
			else_if = { limit = { has_building = village }
				multiply_variable = {
					which = AN_pop_growth
					value = 0.75
				}
				multiply_variable = {
					which = AN_migration_growth
					value = 0.25
				}
			}
			else_if = { limit = { has_building = town }
				multiply_variable = {
					which = AN_pop_growth
					value = 0.8
				}
				multiply_variable = {
					which = AN_migration_growth
					value = 0.2
				}
			}
			else_if = { limit = { has_building = city }
				multiply_variable = {
					which = AN_pop_growth
					value = 0.9
				}
				multiply_variable = {
					which = AN_migration_growth
					value = 0.1
				}
			}
			else_if = { limit = { has_building = metropolis }
				multiply_variable = {
					which = AN_migration_growth
					value = 0
				}
			}
			else = {
				multiply_variable = {
					which = AN_pop_growth
					value = 0.5
				}
				multiply_variable = {
					which = AN_migration_growth
					value = 0.5
				}
			}
		}
		else = {
			set_variable = { which = AN_migration_growth value = -1 }
		}
		
		#Trade Goods
		#trigger_switch = {
		#	on_trigger = trade_goods
			##IMMATURE UNREFINED 
		#	birds = { }
		#	bison = { }
		#	camels = { }
		#	copper = { }
		#	crustaceans = { }
		#	dates = { }
		#	fish = { }
		#	fruit = { }
		#	fur = { }
		#	gold = { }
		#	grain = { }
		#	hardwood = { }
		#	herbs = { }
		#	horses = { }
		#	incense = { }
		#	ivory = { }
		#	livestock = { }
		#	maize = { }
		#	millet = { }
		#	palm = { }
		#	pelagic_fish = { }
		#	potatoes = { }
		#	pottery = { }
		#	poultry = { }
		#	rice = { }
		#	salt = { }
		#	shoal_fish = { }
		#	silver = { }
		#	softwood = { }
		#	stone = { }
		#	tomatoes = { }
		#	tin = { }
		#	tropical_wood = { }
		#	whales = { }
		#	wool = { }
		#	## MATURE UNREFINED 
		#	apiculture = { }
		#	alum = { }
		#	cloves = { }
		#	black_pepper = { }
		#	cocoa = { }
		#	carpet = { }
		#	cassava = { }
		#	cinnamon = { }
		#	coffee = { }
		#	cotton = { }
		#	dairy = { }
		#	dyes = { }
		#	gems = { }
		#	hemp = { }
		#	iron = { }
		#	lead = { }
		#	leather = { }
		#	marble = { }
		#	mercury = { }
		#	nutmeg = { }
		#	chili_peppers = { }
		#	nuts = { }
		#	spices = { }
		#	olives = { }
		#	opium = { }
		#	paper = { }
		#	niter = { }
		#	slaves = { }
		#	saffron = { }
		#	silk = { }
		#	legumes = { }
		#	sugar = { }
		#	sulfur = { }
		#	tea = { }
		#	tobacco = { }
		#	vanilla = { }
		#	## IMMATURE REFINED 
		#	art = { }
		#	artifices = { }
		#	beer = { }
		#	bricks = { }
		#	books = { }
		#	brass = { }
		#	bronze = { }
		#	cigars = { }
		#	confectionary = { }
		#	fertilizer = { }
		#	glass = { }
		#	gunpowder = { }
		#	metalwork = { }
		#	jewelry = { }
		#	liquor = { }
		#	naval_supplies = { }
		#	chinaware = { }
		#	resin = { }
		#	rubber = { }
		#	rum = { }
		#	steel = { }
		#	cloth = { }
		#	wine = { }
		#	## MATURE REFINED 
		#	aluminum = { }
		#	chemicals = { }
		#	concrete = { }
		#	explosives = { }
		#	machines = { }
		#	machine_parts = { }
		#	medicine = { }
		#	munitions = { }
		#	perfume = { }
		#	preserves = { }
		#	## LATENT 
		#	chromite = { }
		#	coal = { }
		#	phosphate = { }
		#}
	}
}


AN_migration_calc = {
	hidden_effect = {
		AN_check_dev_variables = yes
		set_variable = { which = AN_sum_E which = AN_migration_growth }
		set_variable = { which = AN_sum_I which = AN_migration_factor }
		if = { 
			limit = { check_variable = { which = AN_migration_growth value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = german } } 4403 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ottoman } } 1781 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = muslim } } 1782 = { change_variable = { which = AN_sum_E which = PREV } } } 			
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { change_variable = { which = AN_sum_E which = PREV } } } 			
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { change_variable = { which = AN_sum_E which = PREV } } } 
		}
		if = { 
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = german } } 4403 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ottoman } } 1781 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = muslim } } 1782 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { change_variable = { which = AN_sum_I which = PREV } } } 					
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { change_variable = { which = AN_sum_I which = PREV } } } 
		}
	}	
}


AN_dev_calc = {
	hidden_effect = {
		set_variable = { which = AN_migration_progress value = 0 }
		if = {
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = german } } 4403 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = ottoman } }  1781 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = muslim } } 1782 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }			
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }				
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			
			set_variable = { which = AN_migration_progress which = AN_migration_factor } 
			divide_variable = { which = AN_migration_progress which = AN_sum_I }
			multiply_variable = { which = AN_migration_progress which = AN_sum_E }

			change_variable = {
				which = AN_pop_progress
				which = AN_migration_progress
			}
		}
		change_variable = {
			which = AN_pop_progress
			which = AN_pop_growth
		}
		
		change_variable = {
			which = AN_wealth_progress
			which = AN_wealth_growth
		}
		
		#WEALTH CALC
		if = {
			limit = { 
				check_variable = { which = AN_wealth_progress value = 100 }
			}
			add_base_tax = 1
			subtract_variable = {
				which = AN_wealth_progress
				value = 100
			}
		}
		#POP CALC
		if = {
			limit = { 
				check_variable = { which = AN_pop_progress value = 100 }
			}
			subtract_variable = {
				which = AN_pop_progress
				value = 100
			}
			add_base_manpower = 1
		}
		else_if = { # lose pop
			limit = { NOT = { check_variable = { which = AN_pop_progress value = 1 } } }
			if = {
				limit = { base_manpower = 2 }
				add_base_manpower = -1
			}
			set_variable = {
				which = AN_pop_progress
				value = 50
			}
		}
		
		if = {
			limit = { check_variable = { which = AN_prov_pop which = AN_prov_pop_cap } }
			province_event = { id = famine.1 }
		}
	
		#Famine calc
		#if = {
		#	limit = { base_manpower = 2 } #WILL ONLY CHECK IF YOU HAVE POPULATION TO LOSE - OTHERWISE IS MOOT
		#	IR_check_famine = yes
		#}
	}
}


AN_check_minorities = {
	hidden_effect = {
		if = {
			limit = { owner = { OR = { primary_culture = variable:PREV:AN_minority_culture accepted_culture = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_integrated_minority_culture_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { culture_group = variable:PREV:AN_minority_culture } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_coexisting_minority_culture_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { culture_group = variable:PREV:AN_minority_culture } } }
			if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_2
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_1
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				remove_province_modifier = AN_integrated_minority_culture_1
				remove_province_modifier = AN_integrated_minority_culture_2
				remove_province_modifier = AN_integrated_minority_culture_3
				remove_province_modifier = AN_coexisting_minority_culture_1
				remove_province_modifier = AN_coexisting_minority_culture_2
				remove_province_modifier = AN_coexisting_minority_culture_3
				remove_province_modifier = AN_oppressed_minority_culture_2
				remove_province_modifier = AN_oppressed_minority_culture_3
				add_permanent_province_modifier = {
					name = AN_oppressed_minority_culture_1
					duration = -1
				}
			}
		}
		#
		if = {
			limit = { owner = { OR = { religion = variable:PREV:AN_minority_religion secondary_religion = variable:PREV:AN_minority_religion } } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_true_faith_minority_religion_1
					duration = -1
				}
			}
		}
		else_if = {
			limit = { owner = { religion_group = variable:PREV:AN_minority_religion } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heretic_minority_religion_1
					duration = -1
				}
			}
	
		}
		else_if = {
			limit = { owner = { NOT = { religion_group = variable:PREV:AN_minority_religion } } }
			if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 3 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_2
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_3
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 2 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_1
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_2
					duration = -1
				}
			}
			else_if = {
				limit = { check_variable = { which = AN_minority_religion_size value = 1 } }
				remove_province_modifier = AN_true_faith_minority_religion_1
				remove_province_modifier = AN_true_faith_minority_religion_2
				remove_province_modifier = AN_true_faith_minority_religion_3
				remove_province_modifier = AN_heretic_minority_religion_1
				remove_province_modifier = AN_heretic_minority_religion_2
				remove_province_modifier = AN_heretic_minority_religion_3
				remove_province_modifier = AN_heathen_minority_religion_2
				remove_province_modifier = AN_heathen_minority_religion_3
				add_permanent_province_modifier = {
					name = AN_heathen_minority_religion_1
					duration = -1
				}
			}
		}
		#
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_culture_size value = 1 } } }
			set_variable = { which = AN_minority_culture value = 0 }
			set_variable = { which = AN_minority_culture_size value = 0 }
			remove_province_modifier = AN_integrated_minority_culture_1
			remove_province_modifier = AN_integrated_minority_culture_2
			remove_province_modifier = AN_integrated_minority_culture_3
			remove_province_modifier = AN_coexisting_minority_culture_1
			remove_province_modifier = AN_coexisting_minority_culture_2
			remove_province_modifier = AN_coexisting_minority_culture_3
			remove_province_modifier = AN_oppressed_minority_culture_1
			remove_province_modifier = AN_oppressed_minority_culture_2
			remove_province_modifier = AN_oppressed_minority_culture_3
		}
		else_if = {
			limit = { NOT = { check_variable = { which = AN_minority_religion_size value = 1 } } }
			set_variable = { which = AN_minority_religion value = 0 }
			set_variable = { which = AN_minority_religion_size value = 0 }
			remove_province_modifier = AN_true_faith_minority_religion_1
			remove_province_modifier = AN_true_faith_minority_religion_2
			remove_province_modifier = AN_true_faith_minority_religion_3
			remove_province_modifier = AN_heretic_minority_religion_1
			remove_province_modifier = AN_heretic_minority_religion_2
			remove_province_modifier = AN_heretic_minority_religion_3
			remove_province_modifier = AN_heathen_minority_religion_1
			remove_province_modifier = AN_heathen_minority_religion_2
			remove_province_modifier = AN_heathen_minority_religion_3
		}
	}
}

AN_culture_calc = {
	hidden_effect = {
		set_variable = { which = AN_assimilate_growth value = 0 }
		if = {
			check_variable = { which = AN_assimilate_culture value = 0 }
			
		}
		change_variable = {
			which = AN_assimilate_progress
			which = AN_assimilate_growth
		}
		if = {
			limit = { 
				check_variable = { which = AN_assimilate_progress value = 100 }
			}
			change_culture = variable:PREV:AN_assimilate_culture
			set_variable = { which = AN_assimilate_culture value = 0 }
			set_variable = { which = AN_assimilate_progress value = 0 }
		}
	}
}

AN_set_assimilate_culture = {
	if = {
		limit = { 12000 = { NOT = { culture = $CULTURE$ } } }
		12000 = { change_culture = $CULTURE$ }
	}
	12000 = {
		export_to_variable = {
			variable_name = AN_assimilate_culture
			value = culture
		}
		PREV = { 
			set_variable = { which = AN_assimilate_culture which = PREV } 
			set_variable = { which = AN_assimilate_progress value = 0 } 
		}
		set_variable = { which = AN_assimilate_culture value = 0 }
		change_culture = variable:PREV:AN_assimilate_culture
	}
}

AN_set_minority_culture = {
	12000 = { 
		change_culture = $CULTURE$ 
		export_to_variable = {
			variable_name = AN_minority_culture
			value = culture
		}
		PREV = { 
			set_variable = { which = AN_minority_culture which = PREV } 
			set_variable = { which = AN_minority_culture_size value = $SIZE$ } 
		}
		set_variable = { which = AN_minority_culture value = 0 }
		change_culture = variable:PREV:AN_minority_culture
	}
	AN_check_minorities = yes
}

AN_change_minority_culture_size = {
	change_variable = { which = AN_minority_culture_size value = $VAL$ }
	if = {
		limit = { check_variable = { which = AN_minority_culture_size value = 4 } }
		change_culture = variable:PREV:AN_minority_culture
		set_variable = {
			which = AN_minority_culture
			which = AN_province_culture
		}
		set_variable = { which = AN_minority_culture_size value = 3 }
	}
	AN_check_minorities = yes
}

AN_set_minority_religion = {
	12000 = { 
		change_religion = $RELIGION$ 
		export_to_variable = {
			variable_name = AN_minority_religion
			value = religion
		}
		PREV = { 
			set_variable = { which = AN_minority_religion which = PREV } 
			set_variable = { which = AN_minority_religion_size value = $SIZE$ } 
			
		}
		set_variable = { which = AN_minority_religion value = 0 }
		change_religion = variable:PREV:AN_minority_religion
	}
	AN_check_minorities = yes
}

AN_change_minority_religion_size = {
	change_variable = { which = AN_minority_religion_size value = $VAL$ }
	if = {
		limit = { check_variable = { which = AN_minority_religion_size value = 4 } }
		change_religion = variable:PREV:AN_minority_religion
		set_variable = {
			which = AN_minority_religion
			which = AN_province_religion
		}
		set_variable = { which = AN_minority_religion_size value = 3 }
	}
	AN_check_minorities = yes
}